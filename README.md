# vdConnection

λ³΄μ• κ°•ν™”λ VDI(Virtual Desktop Infrastructure) μλ™ μ—°κ²° λ„κµ¬

Nurum Labμ VDIμ— μλ™μΌλ΅ λ΅κ·ΈμΈν•κ³  μ—°κ²°ν•λ” Go κΈ°λ° λ„κµ¬μ…λ‹λ‹¤. AES-256 μ•”νΈν™”μ™€ Windows Credential Managerλ¥Ό μ‚¬μ©ν•μ—¬ μ‚¬μ©μ μΈμ¦ μ •λ³΄λ¥Ό μ•μ „ν•κ² λ³΄νΈν•©λ‹λ‹¤.

## π”’ λ³΄μ• κΈ°λ¥

- **AES-256-GCM μ•”νΈν™”**: μ‚¬μ©μ μΈμ¦ μ •λ³΄λ¥Ό AES-256-GCM μ•κ³ λ¦¬μ¦μΌλ΅ μ•”νΈν™”
- **Windows Credential Manager μ—°λ™**: μ•”νΈν™” ν‚¤λ¥Ό μ‹μ¤ν… λ λ²¨μ—μ„ μ•μ „ν•κ² κ΄€λ¦¬
- **Salt κΈ°λ° ν‚¤ μ λ„**: scryptλ¥Ό μ‚¬μ©ν• μ•μ „ν• ν‚¤ μ λ„ ν•¨μ
- **λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦**: GCM λ¨λ“λ΅ λ°μ΄ν„° λ³€μ΅° κ°μ§€
- **κΈ°μ΅΄ ν‰λ¬Έ νμΌ μλ™ λ³€ν™**: κΈ°μ΅΄ ν‰λ¬Έ μ„¤μ •μ„ μλ™μΌλ΅ μ•”νΈν™”

## π“‹ κΈ°λ¥

- VDI ν¬ν„Έ μλ™ λ΅κ·ΈμΈ
- TOTP(Time-based OTP) μλ™ μƒμ„± λ° μ…λ ¥
- 2λ‹¨κ³„ μΈμ¦ μλ™ μ²λ¦¬
- VDI λ°μ¤ν¬ν†± μλ™ μ—°κ²°
- μ•”νΈν™”λ μ„¤μ • νμΌ κ΄€λ¦¬
- Interface ν¨ν„΄μΌλ΅ ν™•μ¥ κ°€λ¥ν• κµ¬μ΅°

## π› οΈ μ”κµ¬μ‚¬ν•­

### ν•„μ μ†ν”„νΈμ›¨μ–΄
- **OS**: Windows (Credential Manager μ‚¬μ©)
- **Go**: 1.21 μ΄μƒ
- **Chrome/Chromium**: λΈλΌμ°μ € μλ™ν™”μ©

### μμ΅΄μ„± ν¨ν‚¤μ§€
```bash
go mod init vdConnection
go get github.com/chromedp/chromedp
go get github.com/danieljoos/wincred
go get golang.org/x/crypto/scrypt
```

## π€ μ‚¬μ©λ²•

### 1. μ΄κΈ° μ„¤μ •
ν”„λ΅κ·Έλ¨μ„ μ²μ μ‹¤ν–‰ν•λ©΄ μ„¤μ • μ •λ³΄λ¥Ό μ…λ ¥ν•λΌλ” ν”„λ΅¬ν”„νΈκ°€ λ‚νƒ€λ‚©λ‹λ‹¤:

```bash
./vdConnection.exe
```

λ‹¤μ μ •λ³΄λ¥Ό μ…λ ¥ν•μ„Έμ”:
- **ID**: VDI ν¬ν„Έ λ΅κ·ΈμΈ ID
- **Password**: VDI ν¬ν„Έ λ΅κ·ΈμΈ λΉ„λ°€λ²νΈ  
- **OTP Secret Key**: TOTP μ•±μ—μ„ μ κ³µν•λ” μ‹ν¬λ¦Ώ ν‚¤

### 2. μ•”νΈν™”λ μ„¤μ • νμΌ ν•μ‹
μ…λ ¥ν• μ •λ³΄λ” μ•”νΈν™”λμ–΄ `config.json` νμΌμ— μ €μ¥λ©λ‹λ‹¤:
```json
{
  "encrypted_data": "base64λ΅ μΈμ½”λ”©λ μ•”νΈν™”λ λ°μ΄ν„°",
  "salt": "base64λ΅ μΈμ½”λ”©λ Salt"
}
```

## π”§ μ£Όμ” κµ¬μ„± μ”μ†

### NurumLab κµ¬μ΅°μ²΄
```go
type NurumLab struct {
    Id        string             `json:"id"`
    Password  string             `json:"password"`
    OtpSecret string             `json:"otp_secret"`
    Ctx       context.Context    `json:"-"`
    Cancel    context.CancelFunc `json:"-"`
}
```

### EncryptedConfig κµ¬μ΅°μ²΄
```go
type EncryptedConfig struct {
    EncryptedData string `json:"encrypted_data"`
    Salt          string `json:"salt"`
}
```

### μ£Όμ” λ©”μ„λ“
- `InitConfig()`: μ•”νΈν™”λ μ„¤μ • νμΌ μ΄κΈ°ν™”
- `Session()`: Chrome λΈλΌμ°μ € μ„Έμ… μƒμ„±
- `Login()`: μλ™ λ΅κ·ΈμΈ μν–‰
- `TwoFactorAuth()`: TOTP 2λ‹¨κ³„ μΈμ¦ μ²λ¦¬
- `GenerateOTP()`: TOTP μ½”λ“ μλ™ μƒμ„±
- `VdCon()`: VDI μ—°κ²° μν–‰
- `Close()`: λ¦¬μ†μ¤ μ •λ¦¬

### λ³΄μ• ν•¨μλ“¤
- `getOrCreateEncryptionKey()`: Credential Managerμ—μ„ μ•”νΈν™” ν‚¤ κ΄€λ¦¬
- `encryptData()`: AES-256-GCM μ•”νΈν™”
- `decryptData()`: AES-256-GCM λ³µνΈν™”
- `saveEncryptedConfig()`: μ•”νΈν™”λ μ„¤μ • μ €μ¥

## π” λ³΄μ• μ•„ν‚¤ν…μ²

### μ•”νΈν™” ν”„λ΅μ„Έμ¤
1. **ν‚¤ μƒμ„±**: 32λ°”μ΄νΈ λλ¤ μ•”νΈν™” ν‚¤ μƒμ„±
2. **ν‚¤ μ €μ¥**: Windows Credential Managerμ— μ•μ „ν•κ² μ €μ¥
3. **Salt μƒμ„±**: κ° μ•”νΈν™”λ§λ‹¤ 16λ°”μ΄νΈ λλ¤ Salt μƒμ„±
4. **ν‚¤ μ λ„**: scrypt(ν‚¤, Salt, N=32768, r=8, p=1)λ΅ μ λ„ν‚¤ μƒμ„±
5. **μ•”νΈν™”**: AES-256-GCMμΌλ΅ λ°μ΄ν„° μ•”νΈν™”
6. **μ €μ¥**: Base64λ΅ μΈμ½”λ”©ν•μ—¬ JSON νμΌμ— μ €μ¥

### Credential Manager μ •λ³΄
- **Target**: `vdConnection_encryption_key`
- **UserName**: `vdConnection`
- **Comment**: `vdConnection μ„¤μ • νμΌ μ•”νΈν™” ν‚¤`

### TOTP κµ¬ν„
- **μ•κ³ λ¦¬μ¦**: HMAC-SHA1
- **μ‹κ°„ λ‹¨μ„**: 30μ΄
- **μ½”λ“ κΈΈμ΄**: 6μλ¦¬
- **Base32 λ””μ½”λ”©**: ν‘μ¤€ λ° NoPadding λ°©μ‹ μ§€μ›

## β™οΈ λΈλΌμ°μ € μµμ…
ν”„λ΅κ·Έλ¨μ€ λ‹¤μ Chrome μµμ…μΌλ΅ μ‹¤ν–‰λ©λ‹λ‹¤:
- **ν—¤λ“λ¦¬μ¤ λ¨λ“**: κΈ°λ³Έ ν™μ„±ν™”
- **μ°½ ν¬κΈ°**: 1200x800
- **νƒ€μ„μ•„μ›ƒ**: 60μ΄
- **GPU μ„¤μ •**: λΉ„ν™μ„±ν™” μ• ν•¨
- **μƒλ“λ°•μ¤**: λΉ„ν™μ„±ν™”

## π›΅οΈ λ³΄μ• κ³ λ ¤μ‚¬ν•­

### κ°•μ 
- β… μ„¤μ • νμΌμ΄ μ•”νΈν™”λμ–΄ ν‰λ¬Έ λ…Έμ¶ λ°©μ§€
- β… μ•”νΈν™” ν‚¤κ°€ Windows λ³΄μ• μ €μ¥μ†μ— μ•μ „ν•κ² λ³΄κ΄€
- β… κ° μ €μ¥λ§λ‹¤ λ‹¤λ¥Έ Salt μ‚¬μ©μΌλ΅ λ¬΄μ§€κ° ν…μ΄λΈ” κ³µκ²© λ°©μ§€
- β… GCM λ¨λ“λ΅ λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦
- β… κΈ°μ΅΄ ν‰λ¬Έ νμΌ μλ™ μ•”νΈν™” λ³€ν™

### μ£Όμμ‚¬ν•­
- β οΈ Windows Credential Managerμ— μ ‘κ·Ό κ¶ν•μ΄ μλ” μ‚¬μ©μλ” ν‚¤μ— μ ‘κ·Ό κ°€λ¥
- β οΈ ν”„λ΅κ·Έλ¨ μ‹¤ν–‰ μ¤‘ λ©”λ¨λ¦¬μ— λ³µνΈν™”λ λ°μ΄ν„°κ°€ μ΅΄μ¬
- β οΈ μ‹μ¤ν… κ΄€λ¦¬μ κ¶ν•μΌλ΅ μ‹¤ν–‰ μ‹ λ” λ†’μ€ λ³΄μ• μ„ν—


## π› λ¬Έμ  ν•΄κ²°

### μΌλ°μ μΈ λ¬Έμ 

**Q: "μ•”νΈν™” ν‚¤ μ¤€λΉ„ μ‹¤ν¨" μ—λ¬κ°€ λ°μƒν•©λ‹λ‹¤**
A: Windows Credential Manager μ ‘κ·Ό κ¶ν•μ„ ν™•μΈν•μ„Έμ”. κ΄€λ¦¬μ κ¶ν•μΌλ΅ μ‹¤ν–‰ν•΄λ³΄μ„Έμ”.

**Q: OTP μ½”λ“κ°€ λ§μ§€ μ•μµλ‹λ‹¤**
A: 
- μ‹μ¤ν… μ‹κ°„μ΄ μ •ν™•ν•μ§€ ν™•μΈν•μ„Έμ”
- OTP Secret Keyκ°€ μ¬λ°”λ¥΄κ² μ…λ ¥λμ—λ”μ§€ ν™•μΈν•μ„Έμ”
- κ³µλ°±, ν•μ΄ν”, μ–Έλ”μ¤μ½”μ–΄λ” μλ™μΌλ΅ μ κ±°λ©λ‹λ‹¤

**Q: λΈλΌμ°μ € μ—°κ²°μ΄ μ‹¤ν¨ν•©λ‹λ‹¤**
A: Chrome/Chromiumμ΄ μ„¤μΉλμ–΄ μλ”μ§€ ν™•μΈν•κ³ , λ°©ν™”λ²½ μ„¤μ •μ„ μ κ²€ν•μ„Έμ”.

**Q: Chrome λΈλΌμ°μ €λ¥Ό μ°Ύμ„ μ μ—†μ**
A: Chrome λλ” Chromiumμ΄ μ„¤μΉλμ–΄ μλ”μ§€ ν™•μΈν•κ³ , PATH ν™κ²½λ³€μλ¥Ό μ κ²€ν•μ„Έμ”.

**Q: VDI μ—°κ²° μ‹¤ν¨**
A: νμ΄μ§€ λ΅λ”© μ‹κ°„ ν™•μΈ λ° μ›Ήμ‚¬μ΄νΈ UI λ³€κ²½ μ—¬λ¶€λ¥Ό ν™•μΈν•μ„Έμ”.

### λ””λ²„κΉ…
- Headless λ¨λ“λ¥Ό λΉ„ν™μ„±ν™”ν•μ—¬ λΈλΌμ°μ € λ™μ‘μ„ μ§μ ‘ ν™•μΈν•  μ μμµλ‹λ‹¤:
```go
chromedp.Flag("headless", false),
```

## π“ λ΅κ·Έ λ©”μ‹μ§€

ν”„λ΅κ·Έλ¨ μ‹¤ν–‰ μ‹ λ‹¤μκ³Ό κ°™μ€ λ΅κ·Έ λ©”μ‹μ§€λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤:

### λ³΄μ• κ΄€λ ¨
- π”‘ μƒ μ•”νΈν™” ν‚¤ μƒμ„±
- β… κΈ°μ΅΄ μ•”νΈν™” ν‚¤ λ΅λ“
- π”’ μ„¤μ • μ•”νΈν™” μ €μ¥ μ™„λ£
- π”„ ν‰λ¬Έ νμΌ μλ™ λ³€ν™

### μΈμ¦ κ΄€λ ¨
- π” λ΅κ·ΈμΈ μ‹μ‘
- β… λ΅κ·ΈμΈ λ²„νΌ ν΄λ¦­ μ„±κ³µ
- π”‘ OTP μΈμ¦ ν™•μΈ μ¤‘
- π”‘ μλ™ μƒμ„±λ OTP μ½”λ“
- β… OTP μΈμ¦ μ™„λ£

### μ—°κ²° κ΄€λ ¨
- π”— vd μ ‘μ† μ‹μ‘
- π vd μ ‘μ† μ„±κ³µ
- β μ¤λ¥ λ©”μ‹μ§€ (μ‹¤ν¨ μ‹)

## π“¦ λΉλ“ λ° λ°°ν¬

### λΉλ“
```bash
go build -o vdConnection.exe vdConnection.go
```

### μ‹¤ν–‰
```bash
./vdConnection.exe
```

## π“„ λΌμ΄μ„ μ¤

μ΄ ν”„λ΅μ νΈλ” MIT λΌμ΄μ„ μ¤ ν•μ— λ°°ν¬λ©λ‹λ‹¤.

## π¤ κΈ°μ—¬

λ²„κ·Έ λ¦¬ν¬νΈλ‚ κΈ°λ¥ μ μ•μ€ μ΄μλ΅ λ“±λ΅ν•΄μ£Όμ„Έμ”.

---

**β οΈ λ³΄μ• κ³µμ§€**: μ΄ λ„κµ¬λ” κ°μΈ μ‚¬μ© λ©μ μΌλ΅ μ μ‘λμ—μµλ‹λ‹¤. ν”„λ΅λ•μ… ν™κ²½μ—μ„ μ‚¬μ©ν•κΈ° μ „μ— μ¶©λ¶„ν• λ³΄μ• κ²€ν† λ¥Ό μν–‰ν•μ„Έμ”.